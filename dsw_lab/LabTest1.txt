create DATABASE shop;

use shop;

CREATE TABLE tbl_order(
	id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	orderdate DATE NOT NULL,
    customerid INT,
    orderamount int
);

INSERT INTO tbl_order
	(id, orderdate, customerid, orderamount) VALUES
		(1, '2020-11-10',10, 82),
		(2, '2020-11-15',14,116);


CREATE TABLE tbl_item(
    id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    itemname CHAR(25) ,
    unitprice INT UNIQUE ,
    stock INT NOT NULL
);

INSERT INTO tbl_item
	(id, itemname, unitprice, stock) VALUES
		(1, 'Bread',30, 5),
        (2, 'Butter',46, 10),
        (3, 'Milk',45, 10),
        (4, 'Eggs',6, 60),
        (5, 'Parle-G',5,100),
        (6, 'Rusk',35, 20);

CREATE TABLE tbl_orderitems(
    orderid INT ,
    itemid INT ,
    quantity INT NOT NULL,
    FOREIGN KEY (orderid) REFERENCES tbl_order(id),
    FOREIGN KEY (itemid) REFERENCES tbl_item(id),
    PRIMARY KEY(orderid,itemid)
);

INSERT INTO tbl_orderitems
	(orderid, itemid, quantity) VALUES
		(1, 1, 2),
        (1,3, 1),
        (1, 4, 12),
        (2, 1, 1),
        (2,2,2),
        (2,4,6),
        (2,5,4),
        (2, 6, 1);

Q2.
select count(*)
from tbl_item
where itemName like "B%" OR itemName like "%k";

Q3.
select i.itemName, sum(o.quantity) as quantity
from tbl_item i, tbl_orderItems o
where i.id = o.itemId
group by o.itemId;

Q4.
Select itemname from tbl_item
where id not in
    (
    select id from
    tbl_orderitems
    );

Q5
SELECT DISTINCT i.itemName
    FROM tbl_Item i
     where i.id IN
     (
         select itemId
         from tbl_orderItems
         group by itemId
         having count(itemId) IN

           (select max(cnt) from
            (select itemId, count(itemId) as cnt from tbl_orderItems
            group by itemid) rc)
     );

Q6
SELECT DISTINCT t.customerid
     FROM tbl_Item i, Tbl_order t, Tbl_OrderItems o
     WHERE t.id=o.orderid AND
     o.itemid IN (
     SELECT id from tbl_item
     WHERE unitprice< (
         SELECT MAX(unitprice)
         from tbl_item)
         )
    limit 1;


SELECT DISTINCT t.customerid
     FROM tbl_Item i, Tbl_order t, Tbl_OrderItems o
     WHERE t.id=o.orderid AND o.itemid = i.id and
     o.itemid IN (
     SELECT id from tbl_item
     WHERE unitprice< (SELECT MAX(unitprice)
     from tbl_item)
     Order by unitprice desc
     limit 1);


/////// Archieves--- do not refer this
Q5
select i.ItemName
from tbl_Item i, Tbl_order t, Tbl_OrderItems o
where t.id=o.Orderid and
i.id=o.Itemid
group by o.itemId
order by count(*) desc limit 1;


